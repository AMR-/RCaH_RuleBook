%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%          $Id: Rulebook.tex 2014-12-12 balkce $
%%    author(s): RoboCupAtHome Technical Committee(s)
%%  description: introduction to RoboCupAtHome
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[11pt, twoside, openright, a4paper, chapterprefix]{scrbook}
\usepackage[inner=2.5cm, outer=2.5cm, top=4cm, bottom=4cm]{geometry}

%%% PACKAGES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{./setup/packages.tex}
\usepackage[titletoc]{appendix}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{gensymb}
\setlist{noitemsep}

%%% SubfigureSetup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\renewcommand{\subfigtopskip}{5pt}        % default is 10pt
%\renewcommand{\subfigbottomskip}{5pt}     % default is 10pt
%\renewcommand{\subfigcapskip}{3pt}        % default is 10pt
%\renewcommand{\subfigcapmargin}{7pt}      % default is 10pt

%%% TweakList-Setup %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\itemhook}{%                 % modify itemize-spacing
  \setlength{\topsep}{2pt}%
  \setlength{\partopsep}{1pt}%
  \setlength{\itemsep}{-1pt}%
}
\renewcommand{\enumhook}{%                 % modify enumerate-spacing
  \setlength{\topsep}{2pt}%
  \setlength{\partopsep}{1pt}%
  \setlength{\itemsep}{-1pt}%
}
\renewcommand{\descripthook}{%             % modify description-spacing
  \setlength{\topsep}{2pt}%
  \setlength{\partopsep}{1pt}%
  \setlength{\itemsep}{-1pt}%
}

\setkomafont{title}{\normalfont}
\setkomafont{sectioning}{\normalfont\bfseries}
\addtokomafont{caption}{\small}
\setkomafont{captionlabel}{\small\bfseries}
\setkomafont{descriptionlabel}{\normalfont\bfseries}
\renewcommand*{\chapterformat}{\LARGE{Chapter \thechapter}}

%%% MACROS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{./setup/active_version.tex}
\graphicspath{{\YEAR/}{./images/}}
\input{./setup/macros.tex}
\input{./setup/abbrevix.tex}



\makeindex                                % generate index
\makeabbex                                % generate abbreviations

%%% DOCUMENTINFO %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hypersetup{
  pdftitle     = {RoboCup@Home Rules and Regulations},
  pdfsubject   = {RoboCup@Home Rulebook},
  pdfauthor    = {RoboCup@Home Technical Committee},
  pdfkeywords  = {RoboCup, @Home, Rules, Competition},
  colorlinks   = true,
  anchorcolor  = blue,
  linkcolor    = blue,
  urlcolor     = blue, 
}

%%% HEADINGS & PAGE STYLE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\footline}{RoboCup@Home Rulebook / \rulebookVersion}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter. \ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection \ #1}{}\renewcommand{\currentTest}{#1}}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\sffamily\rightmark}
\fancyhead[LO]{\sffamily\leftmark}
\fancyfoot[C]{\scriptsize \sffamily \footline{}}
\fancypagestyle{plain}{
        \fancyhf{}
        \fancyhead[LE,RO]{\thepage}
        \fancyhead[RE]{\sffamily\rightmark}
        \fancyhead[LO]{\sffamily\leftmark}
        \fancyfoot[C]{\scriptsize \sffamily \footline{}}
		\renewcommand{\headrulewidth}{0.5 pt}
}
\fancypagestyle{empty}{
        \fancyhf{}
        \fancyhead{}
        \fancyfoot[C]{\scriptsize \sffamily \footline{}}
		\renewcommand{\headrulewidth}{0 pt}
}

%\newcommand{\sectionbreak}{\clearpage}
%\newcommand{\subsectionbreak}{\clearpage}


%%%%%%%%%%%%%%%%%%%\renewcommand{%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\input{./pages/titlepage}

\pagestyle{empty}
\input{./pages/acknowledgments}
\clearpage

\pagestyle{empty}
\tableofcontents
\clearpage

\pagestyle{plain}

\input{Introduction}

\input{CompetitionConcepts}

\input{GeneralRules}

\input{Setup}

\chapter{Tests in Stage I}
\label{chap:stage_I}

\begin{itshape}
\iterm{Stage~I} is built around the demonstrations of key concepts detailed in this chapter, each in its own section. Each key concept is designed to evaluate the performance of the robot in one particular skill, providing data for benchmarking. 

The total score for \iterm{Stage~I} is the sum of the scores of all the demonstrations provided by the teams.
The number of demonstrations per team will be preferably three, which could be changed given the time constraints of the competition.
The point of having several demonstrations is both to eliminate good and bad luck for the robots/teams and to get a more objective view of the performance,
not to give teams time to tweak the robot between test performances. 

\end{itshape}

\subsection*{Scheduling}
For maximal efficiency, teams will be scheduled interleaved: 
  Team A does an attempt while team B sets up their robot. When A is done, it moves out the way for team B, then B attempts while A sets up the robot again etc.

The preparing team should prepare their robot close to the place of the test, but not interfere with the performing robot.
Prepared robots must wait at this preparation location until commanded to start the test.
When commanded to start, the robot must move automatically beyond this point. 

Robot should be ready to start the next attempt to the same test as fast as possible: 
  when the performing robot is done with a attempt, the next robot must be ready to go with the start of a button or a voice command.

\subsection*{Scoring}
%difficulty score should be between: 30 and 70
The overall score of a demonstration is the sum of two scores: Difficulty (D) and Execution (E).

Each demonstration can present up to 3 key concepts. Each key concept bears a difficulty which is awarded to the team if demonstrated succesfully. The sum of all the scores of succesfully demonstrated key concepts provides the overall Difficulty score (D) of the demonstration.

In addition, the Execution score (E) is an objective evaluation of the overall demonstration. It implements several additional points to encourage behaviors the TC/EC expects from robots, as well as disencourage point-abusing tactics.

Thus, the overall score of a demonstration is $D+E$.

\newpage
\section{Execution Score}

The Execution score (E) is calculated by $50 - P$, where $P$ is the sum of all accumulated penalties, listed below:

\begin{itemize}
	\item Missing key concepts:
    \begin{itemize}
	    \item No missing key concepts: 0
	    \item 1 missing key concept: 10
	    \item 2 missing key concepts: 25
	    \item 2 missing key concepts: 50
    \end{itemize}
	\item Key concept was shown before: $D_i (1 - \gamma^N_i)$, where $D_i$ is the Difficulty score of the $i$ key concept shown before, $N_i$ is the number of times the $i$ key concept has been demonstrated before by the same team, and $\gamma = 0.9$.
	\item No moderator explaining: 10.
	\item Inactivity from the robot: $5T$ where $T$ is the number of minutes the robot is not doing anything.
\end{itemize}

\newpage
\input{keyconcepts/Audition}
\input{keyconcepts/ComplexAudition}
\input{keyconcepts/Manipulation}
\input{keyconcepts/ComplexManipulation}
\input{keyconcepts/Navigation}
\input{keyconcepts/ObjectRecognition}
\input{keyconcepts/ComplexObjectRecognition}

\chapter{Tests in Stage II}
\label{chap:stage_II}

\begin{itshape}
All ability and integration tests in \iterm{Stage~II}  are performed only once. Some tests have optional tasks that grant additional points when performed correctly, clean and fast. The \iaterm{Technical Committee}{TC} must be informed if a team is planning to perform any of the optional tasks. Unless explicitly stated otherwise, no additional time is given while performing optional tasks.

In the \iterm{Open Challenge} the robot must be able to show to the \iaterm{Technical Committee}{TC} the achievements on the main research line of its own team. This test grants up to 250 points.

\section*{Robot \& team cooperation}
We encourage robots and teams to work together when performing tests.
For scoring, points are awarded per subtask. The robot (and thus team) performing the subtask gets the points.
For example, in the Restaurant test, if one robot of team A can take the order and another robot of team B delivers the order, then the points for taking the order go to team A, while the points for delivering go to team B. 
Of course, team A \& B can both perform the test in their own turn.

\end{itshape}

\newpage
\input{tests/EEGPSR}

\newpage
\input{tests/OpenChallenge}

\newpage
\input{tests/Restaurant}

\newpage
\input{tests/SetATableTidyUp}

\newpage
\input{tests/TourGuide.tex}

\newpage
\input{tests/Finals}

\input{Appendices}

\printabx
\printidx

\end{document}
